<!DOCTYPE html>
<html lang="en">

<head>

    <title>ChatRoom</title>
</head>

<body>
    <h3>Words of a werewolf type thing.</h3>
    <div id="chat" style="width: 500px; height: 400px; border: 1px solid black; overflow-y: scroll;"></div>
    <br>
    <input type="text" id="inp_message" placeholder="Enter message" disabled>
    <button type="submit" id="send" disabled>Send</button>
    <p>Username: <input type="text" id="username" placeholder="Enter username"></p>
    <button type="submit" id="connect">Connect</button>
    <button type="submit" id="disconnect" disabled>Disconnect</button>
    <button type="submit" id="clear">Clear username</button>
    <button type="submit" id="proper_noun" disabled>Is it a proper noun?</button>

    <script>
        proper_noun.disabled = true
        if (localStorage.getItem("username") != null) {
            username.defaultValue = localStorage.getItem("username");
        }
        var user = username.value;
        let socket = io({ autoConnect: false });
        user_clear.onclick = function () {
            localStorage.removeItem("username")
            username.value = ""
        }
        btn_connect.onclick = function () {
            if (username.value != "") {
                localStorage.setItem("username", username.value)
                socket.connect();
            }
            else {
                alert("Please enter an username!");
                console.log("Please enter an username!");
            }
        };

        socket.on('connect', function () {
            inp_message.disabled = false;
            send.disabled = false;
            proper_noun.disabled = false;
            username.disabled = true;
            btn_connect.disabled = true;
            user = username.value;
            socket.emit('notify', user + " joined!");
            btn_disconnect.disabled = false;
            ptag = document.createElement('p');
            ptag.innerHTML = "You joined!";
            chat.appendChild(ptag);
            console.log("Connected to server!");
        });
        socket.on('disconnect', function () {
            ptag = document.createElement('p');
            ptag.innerHTML = "You left!";
            chat.appendChild(ptag);
            console.log('Disconnected to server!')
            inp_message.disabled = true;
            send.disabled = true;
            username.disabled = false;
            btn_connect.disabled = false;
            btn_disconnect.disabled = true
            socket.close();
        });
        socket.on('notify', function (status) {
            ptag = document.createElement('p');
            ptag.innerHTML = status;
            chat.appendChild(ptag);
        });
        btn_disconnect.onclick = function () {
            socket.emit('notify', user + " left!");
            socket.close();
        };
        send.onclick = function () {
            socket.emit('data', "[" + user + "]: " + inp_message.value);
            inp_message.value = "";
        };
        proper_noun.onclick = function () {
            socket.emit('data', "[" + user + "]: Is it a proper noun?");
        }
        socket.on('returndata', function (data) {
            chat.innerHTML = "<pre>" + data + "</pre>" + chat.innerHTML;
        });
    </script>
</body>

</html>